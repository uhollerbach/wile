// Generated by wile, the extremely stable scheming genius compiler

#include "wile-rtl1.h"
#include "wile-rtl2.h"

// declarations

extern lval var_argv;
extern lval var_cmd_name;
extern lval var_stdin;
extern lval var_stdout;
extern lval var_stderr;
extern lval var_pi;
extern lval var_euler_gamma;
extern lval var_show_sign;
extern lval var_int_base;
extern lval var_flt_base;
extern lval var_flt_precision;
#include "wile-rtl2.h"
static lval fn_16(lptr*, lptr, const char*);
static lval fn_58(lptr*, lptr, const char*);
static lval fn_66(lptr*, lptr, const char*);
static lval fn_74(lptr*, lptr, const char*);

// definitions

// @@@ lambda (n) @@@ bld-rtl-dir/wile-rtl2-000085.scm:43 @@@ fn_16 @@@
static lval fn_16(lptr* var_17, lptr var_18, const char* cloc)
{
lval var_20;
lval var_22;
var_22 = LVI_BOOL(var_18[0].vt == LV_NIL);
if (!LV_IS_FALSE(var_22)) {
lval var_23;
var_23 = LVI_STRING("");
var_20 = var_23;
goto lbl_21;
}
lval var_24;
var_24 = LVI_BOOL(var_18[0].vt == LV_STRING);
if (!LV_IS_FALSE(var_24)) {
var_20 = var_18[0];
goto lbl_21;
}
lval var_25;
var_25 = LVI_BOOL(var_18[0].vt == LV_SYMBOL);
if (!LV_IS_FALSE(var_25)) {
lval var_26;
var_26 = LVI_STRING(var_18[0].v.str);
var_20 = var_26;
goto lbl_21;
}
lval var_27;
var_27 = LVI_BOOL(var_18[0].vt == LV_BOOL);
if (!LV_IS_FALSE(var_27)) {
lval var_28;
if (LV_IS_FALSE(var_18[0])) {
lval var_29;
var_29 = LVI_STRING("#f");
var_28 = var_29;
} else {
lval var_30;
var_30 = LVI_STRING("#t");
var_28 = var_30;
}
var_20 = var_28;
goto lbl_21;
}
lval var_31;
var_31 = LVI_BOOL(var_18[0].vt == LV_CMPLX || var_18[0].vt == LV_REAL || var_18[0].vt == LV_RAT || var_18[0].vt == LV_INT);
if (!LV_IS_FALSE(var_31)) {
lval var_32;
var_32 = wile_num2string(var_18[0], 10, INT_MIN, "bld-rtl-dir/wile-rtl2-000085.scm:48");
var_20 = var_32;
goto lbl_21;
}
lval var_33;
var_33 = LVI_STRING("%v");
lval var_34;
{
lval var_36[1];
var_36[0] = var_18[0];
var_34 = wile_gen_list(1, var_36, NULL);
}
{
lval var_35[8];
var_35[0] = var_33;
var_35[1] = var_34;
var_34 = wile_sprintf(NULL, var_35, "bld-rtl-dir/wile-rtl2-000085.scm:49");
}
var_20 = var_34;
lbl_21:;
return var_20;
}
// end of lambda fn_16

// @@@ max/i @@@ bld-rtl-dir/wile-rtl2-000085.scm:51 @@@ fn_40 @@@
static lval fn_40(lptr* var_41, lptr var_42, const char* cloc)
{
lval var_44;
var_44 = LVI_INT((var_42[0].v.iv > var_42[1].v.iv) ? var_42[0].v.iv : var_42[1].v.iv);
return var_44;
}
// end of prim fn_40

// @@@ string-length @@@ bld-rtl-dir/wile-rtl2-000085.scm:51 @@@ fn_46 @@@
static lval fn_46(lptr* var_47, lptr var_48, const char* cloc)
{
lval var_50;
#ifdef WILE_DO_CHECK
if (var_48[0].vt != LV_STRING) {
wile_exception("string-length", "bld-rtl-dir/wile-rtl2-000085.scm:51", "input is not a string");
}
#endif // WILE_DO_CHECK
var_50 = LVI_INT(strlen(var_48[0].v.str));
return var_50;
}
// end of prim fn_46

// @@@ lambda (s) @@@ bld-rtl-dir/wile-rtl2-000085.scm:52 @@@ fn_58 @@@
static lval fn_58(lptr* var_59, lptr var_60, const char* cloc)
{
lval var_62;
var_62 = LVI_CHAR(32);
lval var_63;
{
lval var_64[8];
var_64[0] = var_60[0];
var_64[1] = var_62;
var_64[2] = V_CLOS(var_59,0);
var_63 = wile_string_pad_left(NULL, var_64, "bld-rtl-dir/wile-rtl2-000085.scm:52");
}
return var_63;
}
// end of lambda fn_58

// @@@ string-join-by @@@ bld-rtl-dir/wile-rtl2-000085.scm:61 @@@ fn_97 @@@
static lval fn_97(lptr* var_98, lptr var_99, const char* cloc)
{
lval var_101;
var_101 = var_99[1];
{
lval var_102[8];
var_102[0] = var_99[0];
var_102[1] = var_101;
var_101 = wile_string_join_by(NULL, var_102, "bld-rtl-dir/wile-rtl2-000085.scm:61");
}
return var_101;
}
// end of prim fn_97

// @@@ lambda (ic acc-c) @@@ bld-rtl-dir/wile-rtl2-000085.scm:58 @@@ fn_74 @@@
static lval fn_74(lptr* var_75, lptr var_76, const char* cloc)
{
lbl_77:;
lval var_78;
lval var_79;
switch (TYPE_COMBO(var_76[0].vt,V_CLOS(var_75,0).vt)) {
case TYPE_COMBO(LV_INT,LV_INT):
var_79 = LVI_BOOL(var_76[0].v.iv >= V_CLOS(var_75,0).v.iv);
break;
case TYPE_COMBO(LV_INT,LV_RAT):
var_79 = LVI_BOOL(var_76[0].v.iv * V_CLOS(var_75,0).v.irv.den >= V_CLOS(var_75,0).v.irv.num);
break;
case TYPE_COMBO(LV_INT,LV_REAL):
var_79 = LVI_BOOL(var_76[0].v.iv >= V_CLOS(var_75,0).v.rv);
break;
case TYPE_COMBO(LV_RAT,LV_INT):
var_79 = LVI_BOOL(var_76[0].v.irv.num >= V_CLOS(var_75,0).v.iv * var_76[0].v.irv.den);
break;
case TYPE_COMBO(LV_RAT,LV_RAT):
var_79 = LVI_BOOL(var_76[0].v.irv.num * V_CLOS(var_75,0).v.irv.den >= V_CLOS(var_75,0).v.irv.num * var_76[0].v.irv.den);
break;
case TYPE_COMBO(LV_RAT,LV_REAL):
var_79 = LVI_BOOL(var_76[0].v.irv.num >= V_CLOS(var_75,0).v.rv * var_76[0].v.irv.den);
break;
case TYPE_COMBO(LV_REAL,LV_INT):
var_79 = LVI_BOOL(var_76[0].v.rv >= V_CLOS(var_75,0).v.iv);
break;
case TYPE_COMBO(LV_REAL,LV_RAT):
var_79 = LVI_BOOL(var_76[0].v.rv * V_CLOS(var_75,0).v.irv.den >= V_CLOS(var_75,0).v.irv.num);
break;
case TYPE_COMBO(LV_REAL,LV_REAL):
var_79 = LVI_BOOL(var_76[0].v.rv >= V_CLOS(var_75,0).v.rv);
break;
default:
wile_exception(">=", "bld-rtl-dir/wile-rtl2-000085.scm:60", "inputs are not real-valued numbers");
break;
}
if (LV_IS_FALSE(var_79)) {
lval var_80;
lval var_81;
if (LV_IS_FALSE(V_CLOS(var_75,1))) {
lval var_82;
var_82 = LVI_INT(V_CLOS(var_75,2).v.iv * V_CLOS(var_75,0).v.iv);
lval var_83;
var_83 = LVI_INT(var_76[0].v.iv + var_82.v.iv);
var_81 = var_83;
} else {
lval var_84;
var_84 = LVI_INT(var_76[0].v.iv * V_CLOS(var_75,3).v.iv);
lval var_85;
var_85 = LVI_INT(V_CLOS(var_75,2).v.iv + var_84.v.iv);
var_81 = var_85;
}
var_80 = var_81;
lval var_86;
var_86 = LVI_INT(1);
lval var_87;
var_87 = LVI_INT(var_76[0].v.iv + var_86.v.iv);
lval var_88;
#ifdef WILE_DO_CHECK
if (V_CLOS(var_75,5).vt != LV_VECTOR) {
wile_exception("vector-ref", "bld-rtl-dir/wile-rtl2-000085.scm:66", "input is not a vector");
}
if (var_80.vt != LV_INT || var_80.v.iv < 0 || (size_t) var_80.v.iv >= V_CLOS(var_75,5).v.vec.capa) {
wile_exception("vector-ref", "bld-rtl-dir/wile-rtl2-000085.scm:66", "got bad index value");
}
#endif // WILE_DO_CHECK
var_88 = V_CLOS(var_75,5).v.vec.arr[var_80.v.iv] ? *(V_CLOS(var_75,5).v.vec.arr[var_80.v.iv]) : LVI_NIL();
lval var_89;
{
lval var_90[1];
var_90[0] = var_88;
var_89 = wile_gen_list(1, var_90, NULL);
}
lval var_91;
{
lval var_92[2];
var_92[0] = V_CLOS(var_75,4);
var_92[1] = var_89;
var_91 = wile_gen_list(2, var_92, NULL);
}
var_91 = wile_apply_function(&(var_91), "bld-rtl-dir/wile-rtl2-000085.scm:66");
lval var_93;
{
lptr p1 = NULL, p2 = NULL;
if (var_91.vt != LV_NIL) {
p1 = new_lv(LV_NIL);
*p1 = var_91;
}
if (var_76[1].vt != LV_NIL) {
p2 = new_lv(LV_NIL);
*p2 = var_76[1];
}
var_93 = LVI_PAIR(p1, p2);
}
lval var_94;
lval var_96[8];
var_96[0] = var_87;
var_96[1] = var_93;
var_76[0] = var_96[0];
var_76[1] = var_96[1];
goto lbl_77;
var_78 = var_94;
} else {
lval var_103;
var_103 = LVI_STRING(" ");
lval var_104;
{
lval var_105[8];
var_105[0] = var_76[1];
var_104 = wile_list_reverse(NULL, var_105, "bld-rtl-dir/wile-rtl2-000085.scm:61");
}
lval var_106;
{
lval var_107[3];
var_107[0] = LVI_PROC(fn_97,NULL,-2);
var_107[1] = var_103;
var_107[2] = var_104;
var_106 = wile_gen_list(3, var_107, NULL);
}
var_106 = wile_apply_function(&(var_106), "bld-rtl-dir/wile-rtl2-000085.scm:61");
var_78 = var_106;
}
return var_78;
}
// end of lambda fn_74

// @@@ lambda (ir acc-r) @@@ bld-rtl-dir/wile-rtl2-000085.scm:53 @@@ fn_66 @@@
static lval fn_66(lptr* var_67, lptr var_68, const char* cloc)
{
lbl_69:;
lval var_70;
lval var_71;
switch (TYPE_COMBO(var_68[0].vt,V_CLOS(var_67,0).vt)) {
case TYPE_COMBO(LV_INT,LV_INT):
var_71 = LVI_BOOL(var_68[0].v.iv >= V_CLOS(var_67,0).v.iv);
break;
case TYPE_COMBO(LV_INT,LV_RAT):
var_71 = LVI_BOOL(var_68[0].v.iv * V_CLOS(var_67,0).v.irv.den >= V_CLOS(var_67,0).v.irv.num);
break;
case TYPE_COMBO(LV_INT,LV_REAL):
var_71 = LVI_BOOL(var_68[0].v.iv >= V_CLOS(var_67,0).v.rv);
break;
case TYPE_COMBO(LV_RAT,LV_INT):
var_71 = LVI_BOOL(var_68[0].v.irv.num >= V_CLOS(var_67,0).v.iv * var_68[0].v.irv.den);
break;
case TYPE_COMBO(LV_RAT,LV_RAT):
var_71 = LVI_BOOL(var_68[0].v.irv.num * V_CLOS(var_67,0).v.irv.den >= V_CLOS(var_67,0).v.irv.num * var_68[0].v.irv.den);
break;
case TYPE_COMBO(LV_RAT,LV_REAL):
var_71 = LVI_BOOL(var_68[0].v.irv.num >= V_CLOS(var_67,0).v.rv * var_68[0].v.irv.den);
break;
case TYPE_COMBO(LV_REAL,LV_INT):
var_71 = LVI_BOOL(var_68[0].v.rv >= V_CLOS(var_67,0).v.iv);
break;
case TYPE_COMBO(LV_REAL,LV_RAT):
var_71 = LVI_BOOL(var_68[0].v.rv * V_CLOS(var_67,0).v.irv.den >= V_CLOS(var_67,0).v.irv.num);
break;
case TYPE_COMBO(LV_REAL,LV_REAL):
var_71 = LVI_BOOL(var_68[0].v.rv >= V_CLOS(var_67,0).v.rv);
break;
default:
wile_exception(">=", "bld-rtl-dir/wile-rtl2-000085.scm:55", "inputs are not real-valued numbers");
break;
}
if (LV_IS_FALSE(var_71)) {
lval var_72;
var_72 = LVI_INT(1);
lval var_73;
var_73 = LVI_INT(var_68[0].v.iv + var_72.v.iv);
MK_CLOS(var_75,6);
lptr var_108 = new_lv(VT_UNINIT);
var_108->v.pair.car = &(V_CLOS(var_67,4));
P_CLOS(var_75,5) = var_108;
lptr var_109 = new_lv(VT_UNINIT);
var_109->v.pair.car = &(V_CLOS(var_67,3));
P_CLOS(var_75,4) = var_109;
lptr var_110 = new_lv(VT_UNINIT);
var_110->v.pair.car = &(V_CLOS(var_67,0));
P_CLOS(var_75,3) = var_110;
lptr var_111 = new_lv(VT_UNINIT);
var_111->v.pair.car = &(var_68[0]);
P_CLOS(var_75,2) = var_111;
lptr var_112 = new_lv(VT_UNINIT);
var_112->v.pair.car = &(V_CLOS(var_67,2));
P_CLOS(var_75,1) = var_112;
lptr var_113 = new_lv(VT_UNINIT);
var_113->v.pair.car = &(V_CLOS(var_67,1));
P_CLOS(var_75,0) = var_113;
lval var_114;
var_114 = LVI_INT(0);
lval var_115;
var_115 = LVI_NIL();
lval var_116;
lval var_117[8];
var_117[0] = var_114;
var_117[1] = var_115;
var_116 = fn_74(var_75, var_117, "bld-rtl-dir/wile-rtl2-000085.scm:58");
*var_111 = var_68[0];
*var_112 = V_CLOS(var_67,2);
*var_108 = V_CLOS(var_67,4);
*var_109 = V_CLOS(var_67,3);
*var_113 = V_CLOS(var_67,1);
*var_110 = V_CLOS(var_67,0);
lval var_119;
{
lptr p1 = NULL, p2 = NULL;
if (var_116.vt != LV_NIL) {
p1 = new_lv(LV_NIL);
*p1 = var_116;
}
if (var_68[1].vt != LV_NIL) {
p2 = new_lv(LV_NIL);
*p2 = var_68[1];
}
var_119 = LVI_PAIR(p1, p2);
}
lval var_120;
lval var_122[8];
var_122[0] = var_73;
var_122[1] = var_119;
var_68[0] = var_122[0];
var_68[1] = var_122[1];
goto lbl_69;
var_70 = var_120;
} else {
lval var_123;
{
lval var_124[8];
var_124[0] = var_68[1];
var_123 = wile_list_reverse(NULL, var_124, "bld-rtl-dir/wile-rtl2-000085.scm:56");
}
var_70 = var_123;
}
return var_70;
}
// end of lambda fn_66

// @@@ (matrix-print mat n-rows n-cols tr) @@@ bld-rtl-dir/wile-rtl2-000085.scm:39 @@@ wile_matrix_print @@@
lval wile_matrix_print(lptr* var_1, lptr var_2, const char* cloc)
{
lval var_5;
{
if (var_2[0].vt == LV_VECTOR) {
var_5 = LVI_INT(var_2[0].v.vec.capa);
} else if (var_2[0].vt == LV_BVECTOR) {
var_5 = LVI_INT(var_2[0].v.bvec.capa);
} else {
wile_exception("vector-length", "bld-rtl-dir/wile-rtl2-000085.scm:40", "input is not a vector");
}
}
lval var_6;
var_6 = LVI_INT(var_2[1].v.iv * var_2[2].v.iv);
lval var_7;
switch (TYPE_COMBO(var_5.vt,var_6.vt)) {
case TYPE_COMBO(LV_INT,LV_INT):
var_7 = LVI_BOOL(var_5.v.iv >= var_6.v.iv);
break;
case TYPE_COMBO(LV_INT,LV_RAT):
var_7 = LVI_BOOL(var_5.v.iv * var_6.v.irv.den >= var_6.v.irv.num);
break;
case TYPE_COMBO(LV_INT,LV_REAL):
var_7 = LVI_BOOL(var_5.v.iv >= var_6.v.rv);
break;
case TYPE_COMBO(LV_RAT,LV_INT):
var_7 = LVI_BOOL(var_5.v.irv.num >= var_6.v.iv * var_5.v.irv.den);
break;
case TYPE_COMBO(LV_RAT,LV_RAT):
var_7 = LVI_BOOL(var_5.v.irv.num * var_6.v.irv.den >= var_6.v.irv.num * var_5.v.irv.den);
break;
case TYPE_COMBO(LV_RAT,LV_REAL):
var_7 = LVI_BOOL(var_5.v.irv.num >= var_6.v.rv * var_5.v.irv.den);
break;
case TYPE_COMBO(LV_REAL,LV_INT):
var_7 = LVI_BOOL(var_5.v.rv >= var_6.v.iv);
break;
case TYPE_COMBO(LV_REAL,LV_RAT):
var_7 = LVI_BOOL(var_5.v.rv * var_6.v.irv.den >= var_6.v.irv.num);
break;
case TYPE_COMBO(LV_REAL,LV_REAL):
var_7 = LVI_BOOL(var_5.v.rv >= var_6.v.rv);
break;
default:
wile_exception(">=", "bld-rtl-dir/wile-rtl2-000085.scm:40", "inputs are not real-valued numbers");
break;
}
if (LV_IS_FALSE(var_7)) {
lval var_8;
var_8 = LVI_STRING("matrix-print: matrix is not big enough!");
lval var_9;
{
if (var_2[0].vt == LV_VECTOR) {
var_9 = LVI_INT(var_2[0].v.vec.capa);
} else if (var_2[0].vt == LV_BVECTOR) {
var_9 = LVI_INT(var_2[0].v.bvec.capa);
} else {
wile_exception("vector-length", "bld-rtl-dir/wile-rtl2-000085.scm:42", "input is not a vector");
}
}
lval var_10;
{
lval var_11[4];
var_11[0] = var_8;
var_11[1] = var_9;
var_11[2] = var_2[1];
var_11[3] = var_2[2];
var_10 = wile_gen_list(4, var_11, NULL);
}
lval var_12;
{
lval var_13[1];
var_13[0] = var_10;
var_12 = wile_gen_list(1, var_13, NULL);
}
if (var_12.vt == LV_PAIR && (var_12.v.pair.cdr == NULL || var_12.v.pair.cdr->vt == LV_NIL)) {
var_12 = (var_12.v.pair.car ? *(var_12.v.pair.car) : LVI_NIL());
}
cachalot->errval = new_lv(LV_NIL);
*(cachalot->errval) = var_12;
cachalot->whence = "bld-rtl-dir/wile-rtl2-000085.scm:41";
longjmp(cachalot->cenv, 1);
} else {
}
lval var_15;
MK_CLOS(var_17,0);
lval var_37;
var_37 = LVI_NIL();
{
lval var_38[8];
var_38[0] = LVI_PROC(fn_16,var_17,1);
var_38[1] = var_2[0];
var_38[2] = var_37;
var_37 = wile_vector_map(NULL, var_38, "bld-rtl-dir/wile-rtl2-000085.scm:43");
}
var_15 = var_37;
lval var_39;
lval var_45;
var_45 = LVI_INT(0);
lval var_51;
{
lval var_52[8];
var_52[0] = var_15;
var_51 = wile_vector2list(NULL, var_52, "bld-rtl-dir/wile-rtl2-000085.scm:51");
}
lval var_53;
var_53 = LVI_NIL();
{
lval var_54[8];
var_54[0] = LVI_PROC(fn_46,NULL,1);
var_54[1] = var_51;
var_54[2] = var_53;
var_53 = wile_map(NULL, var_54, "bld-rtl-dir/wile-rtl2-000085.scm:51");
}
lval var_55;
{
lval var_56[8];
var_56[0] = LVI_PROC(fn_40,NULL,2);
var_56[1] = var_45;
var_56[2] = var_53;
var_55 = wile_foldl(NULL, var_56, "bld-rtl-dir/wile-rtl2-000085.scm:51");
}
var_39 = var_55;
lval var_57;
MK_CLOS(var_59,1);
lptr var_65 = new_lv(VT_UNINIT);
var_65->v.pair.car = &(var_39);
P_CLOS(var_59,0) = var_65;
var_57 = LVI_PROC(fn_58,var_59,1);
MK_CLOS(var_67,5);
lptr var_125 = new_lv(VT_UNINIT);
var_125->v.pair.car = &(var_15);
P_CLOS(var_67,4) = var_125;
lptr var_126 = new_lv(VT_UNINIT);
var_126->v.pair.car = &(var_57);
P_CLOS(var_67,3) = var_126;
lptr var_127 = new_lv(VT_UNINIT);
var_127->v.pair.car = &(var_2[3]);
P_CLOS(var_67,2) = var_127;
lptr var_128 = new_lv(VT_UNINIT);
var_128->v.pair.car = &(var_2[2]);
P_CLOS(var_67,1) = var_128;
lptr var_129 = new_lv(VT_UNINIT);
var_129->v.pair.car = &(var_2[1]);
P_CLOS(var_67,0) = var_129;
lval var_130;
var_130 = LVI_INT(0);
lval var_131;
var_131 = LVI_NIL();
lval var_132;
lval var_133[8];
var_133[0] = var_130;
var_133[1] = var_131;
var_132 = fn_66(var_67, var_133, "bld-rtl-dir/wile-rtl2-000085.scm:53");
*var_125 = var_15;
*var_126 = var_57;
*var_129 = var_2[1];
*var_128 = var_2[2];
*var_127 = var_2[3];
*var_65 = var_39;
return var_132;
}
// end of function wile_matrix_print
